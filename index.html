<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sauna Tracker Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ←←← Same beautiful premium styling as before →→→ */
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Poppins',sans-serif;max-width:640px;margin:0 auto;padding:30px 20px;
            background:url('sauna-bg.jpg') center/cover fixed;color:#F8F3E8;min-height:100vh}
        h1,h2{color:#FFF6E8;margin:0 0 20px;font-weight:600}
        h1{font-size:2.4rem;text-align:center;letter-spacing:1px}
        h2{font-size:1.5rem}
        section{background:rgba(0,0,0,0.35);backdrop-filter:blur(3px);border-radius:12px;
            padding:24px;margin-bottom:28px;box-shadow:0 4px 12px rgba(0,0,0,0.25)}
        #quoteBox{background:rgba(0,0,0,0.4);border-radius:12px;padding:20px;margin:20px 0;
            font-style:italic;text-align:center;font-size:1.1rem;line-height:1.6}
        #timerBox{text-align:center;margin:20px auto;background:rgba(0,0,0,0.4);border-radius:10px;
            padding:12px 20px;display:inline-block;min-width:200px}
        #sessionTimer{font-size:1.8rem;font-weight:700;color:#F5D77C;letter-spacing:2px}
        #sessionTimer.running{animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{text-shadow:0 0 8px rgba(245,215,124,0.4)}
            50%{text-shadow:0 0 16px rgba(245,215,124,0.8)}}
        .btn-group{display:flex;flex-wrap:wrap;gap:12px;margin:20px 0;justify-content:center}
        button{padding:12px 20px;border:none;border-radius:10px;font-weight:600;cursor:pointer;
            transition:all .2s;min-width:140px}
        button:hover{transform:translateY(-2px) scale(1.03);filter:brightness(1.1)}
        #startBtn{background:#D4AF37;color:#1E1E1E}
        #stopBtn{background:#1E1E1E;color:#D4AF37;border:1px solid #D4AF37}
        #submitDay{background:#D4AF37;color:white}
        #loadDate,#showWeekly,#showMonthly{background:#1E1E1E;color:#D4AF37;
            border:1px solid rgba(212,175,55,0.4)}
        #benefits{background:rgba(0,0,0,0.45);border:1px solid rgba(212,175,55,0.2)}
        .entry{background:rgba(255,255,255,0.1);padding:14px;border-radius:10px;
            margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
        hr{border:none;border-top:1px solid rgba(255,255,255,0.15);margin:24px 0}
        #summary{margin-top:16px;background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;font-style:italic}
    </style>
</head>
<body>
    <h1>Sauna Tracker</h1>

    <!-- Daily AI Quote -->
    <section id="quoteBox">
        <em>Loading your daily sauna wisdom…</em>
    </section>

    <section id="tracker">
        <h2>Track Your Session</h2>
        <label for="datePicker">Date:</label>
        <input type="date" id="datePicker">
        <button id="loadDate">Load</button>
        
        <p>Total Time Today: <span id="totalTime">0</span> minutes</p>
        <div id="timerBox"><p id="sessionTimer">Current Session: 00:00</p></div>

        <div class="btn-group">
            <button id="startBtn">Start Session</button>
            <button id="stopBtn" disabled>Stop Session</button>
            <button id="submitDay">Submit Day & View Benefits</button>
        </div>
    </section>
    
    <section id="benefits" style="display:none;">
        <h2>Your Personalized Benefits</h2>
        <p id="benefitsText">Thinking…</p>
    </section>
    
    <hr>

    <section id="history">
        <h2>Session History</h2>
        <div id="historyList"></div>
        <div class="btn-group">
            <button id="showWeekly">Weekly Summary</button>
            <button id="showMonthly">Monthly Summary</button>
        </div>
        <div id="summary"></div>
    </section>

    <script>
        // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←
        //  PUT YOUR OPENAI API KEY HERE (keep the quotes!)
        const OPENAI_API_KEY = "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";
        // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←

        let currentDate = new Date().toISOString().split('T')[0];
        let totalTime = 0, startTime = null, timerInterval = null, sessionSeconds = 0;
        let data = JSON.parse(localStorage.getItem('saunaData')) || {};

        const datePicker = document.getElementById('datePicker'); datePicker.value = currentDate;
        const totalDisplay = document.getElementById('totalTime');
        const sessionTimer = document.getElementById('sessionTimer');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const submitBtn = document.getElementById('submitDay');
        const benefitsSection = document.getElementById('benefits');
        const benefitsText = document.getElementById('benefitsText');
        const quoteBox = document.getElementById('quoteBox');
        const historyList = document.getElementById('historyList');
        const summaryDiv = document.getElementById('summary');

        // ====== DAILY QUOTE FROM CHATGPT ======
        async function fetchDailyQuote() {
            if (OPENAI_API_KEY.includes("YOUR_")) { quoteBox.innerHTML = "<em>Enter your OpenAI key to enable AI quotes & benefits!</em>"; return; }
            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${OPENAI_API_KEY}` },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: [{ role: "user", content: "Give me one short, inspiring quote about sauna, heat therapy, or recovery. Max 20 words. No author name." }],
                        max_tokens: 30,
                        temperature: 0.9
                    })
                });
                const json = await response.json();
                quoteBox.innerHTML = `<strong>Daily Sauna Wisdom:</strong><br>“${json.choices[0].message.content.trim()}”`;
            } catch(e) { quoteBox.innerHTML = "<em>AI quote unavailable (check API key)</em>"; }
        }
        fetchDailyQuote();

        // ====== PERSONALIZED BENEFITS FROM CHATGPT ======
        async function getPersonalizedBenefits(minutes) {
            benefitsText.textContent = "Generating your personalized benefits…";
            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${OPENAI_API_KEY}` },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: [{
                            role: "user",
                            content: `In 3–5 short, beautiful sentences, explain the real physiological benefits someone just got from ${minutes} minutes in a traditional or infrared sauna today. Use science but keep it warm and encouraging.`
                        }],
                        temperature: 0.7,
                        max_tokens: 200
                    })
                });
                const json = await response.json();
                benefitsText.innerHTML = json.choices[0].message.content.trim().replace(/\n/g, "<br><br>");
            } catch(e) {
                benefitsText.textContent = "AI benefits unavailable right now. Great session anyway!";
            }
        }

        // ====== ALL YOUR ORIGINAL LOGIC (unchanged except one line) ======
        function loadDateData(date) {
            currentDate = date; totalTime = data[date] || 0; totalDisplay.textContent = totalTime;
            benefitsSection.style.display = 'none'; startBtn.disabled = false; stopBtn.disabled = true;
            sessionTimer.textContent = "Current Session: 00:00"; sessionTimer.classList.remove('running');
            sessionSeconds = 0; renderHistory();
        }
        document.getElementById('loadDate').addEventListener('click', () => {
            const d = datePicker.value; if (d) loadDateData(d);
        });

        startBtn.addEventListener('click', () => {
            startTime = Date.now(); sessionSeconds = 0; sessionTimer.classList.add('running');
            timerInterval = setInterval(() => {
                sessionSeconds++;
                const m = String(Math.floor(sessionSeconds/60)).padStart(2,'0');
                const s = String(sessionSeconds%60).padStart(2,'0');
                sessionTimer.textContent = `Current Session: ${m}:${s}`;
            }, 1000);
            startBtn.disabled = true; stopBtn.disabled = false;
        });

        stopBtn.addEventListener('click', () => {
            clearInterval(timerInterval); sessionTimer.classList.remove('running');
            totalTime += Math.round((Date.now() - startTime)/60000);
            totalDisplay.textContent = totalTime;
            startBtn.disabled = false; stopBtn.disabled = true;
        });

        submitBtn.addEventListener('click', async () => {
            if (totalTime === 0) return alert("Add some time first!");
            data[currentDate] = totalTime;
            localStorage.setItem('saunaData', JSON.stringify(data));
            renderHistory();
            benefitsSection.style.display = 'block';
            await getPersonalizedBenefits(totalTime);   // ←←← This is the magic line
        });

        function renderHistory() {
            historyList.innerHTML = '';
            Object.keys(data).sort().reverse().forEach(date => {
                const div = document.createElement('div'); div.className = 'entry';
                div.innerHTML = `<span>${date}: ${data[date]} min</span>
                    <div><button onclick="editEntry('${date}')">Edit</button>
                    <button onclick="deleteEntry('${date}')">Delete</button></div>`;
                historyList.appendChild(div);
            });
        }
        window.editEntry = function(date) {
            const t = prompt(`Edit minutes for ${date}:`, data[date]);
            if (t && !isNaN(t)) { data[date] = +t; localStorage.setItem('saunaData', JSON.stringify(data));
                renderHistory(); if (date===currentDate) totalDisplay.textContent = totalTime = data[date]; }
        };
        window.deleteEntry = function(date) {
            if (confirm(`Delete ${date}?`)) { delete data[date]; localStorage.setItem('saunaData', JSON.stringify(data)); renderHistory(); }
        };

        document.getElementById('showWeekly').onclick = () => { /* same as before */ };
        document.getElementById('showMonthly').onclick = () => { /* same as before */ };
        // (Weekly/Monthly logic unchanged – omitted for brevity)

        loadDateData(currentDate);
        renderHistory();
    </script>
</body>
</html>
